# RESEARCH 
All files are notebook files and are used on kaggle, where the baseline is located. I mainly edited the baseline on Kaggle so this code may not run on your machines. This could however be run on kaggle.
## First question
The first research question was about improving recall of the candidate generation process by grouping according to age groups
For this I used the baseline of RADEK.  In addition to the adding of some of my features, and other things, I also sometimes added some comments or markdowns for better readability. This my mostly for my own sake.

For this first question I made the 'researchquestion1_v1' file. In this I made several sections where changes are made. This is a list of all these section trying to describe the exact changes and the places, so you will not have to look for them.
1. **TEST WEEK**: This section goes from the title 'test week' until the title 'generating candidates'. Here I change the test week into a more easily changed variable to test out different weeks. On top of that the transactions are changed so that the last 10 weeks before that week are used.
2. **RECALL**: this part starts from the title ' Making a recall evaluation function' and end at 'making ne group of candidates based on age group'. In this part I personally made a recall evaluation function. I did this by looping over all users and calculating their recall by taking subsets of these tables and performing some selection operations to then calculate some values. Doing this made the function so immensely slow that I asked Noah Daniels for help. He helped me come to a solution based on merges. This function ultimately returns the mean recall value.
3. **AGE GROUPS**: Starts at 'Making a new group of candidates based on age group' and stops at 'My Code'. Here several things are done:
   * The age groups are created, and then applied on the dataset. 
   * Then the bestseller candidates are generated by altering the process for bestsellers from RADEK with grouping on age groups as addition.
   * Checking the recall happens in the section 'check the recall'

In the end the age group bestseller rank was not yet used, neither was age group itself. This was because the focus was on candidate generation and  not score improvement.

## Adding age groups to the ranker
This step of the process was taken in the file 'baseline-with-age-group'.
This build upon the previous step and keeps most of the code intact.
The parts that were altered are:
1. **TEST WEEK**: transactions that are kept now drop the index upon resetting
2. **MERGE WITH DATA**: under the title 'add bestseller information' the data is merged with bestseller information, also known as their bestseller ranking
3. **COLUMNS TO USE**: The columns to use are different now, where age group and age group bestseller are now used

The results here are very promising at first, the two top scoring features in importance ranking are the ones I initially wanted to come out on top. 
The scores this output gave on kaggle however indicated the opposite. After some digging it seemed that the age group feature of non age group related candidates was NAN which resulted in wrongful learning. 

## Changing to function approach
This step is to be seen in the file 'changed-to-functions-no-predictions-yet'
This is a big step that required multiple changes and a lot of copy and pasting.
Not much results were collected from this, certainly kaggle scores as the scoring was not yet available.
Main changes are the refactoring in a candidate generation and feature selection function. The other part was the one cell code on introducing a test week, taking its data and then calling the candidate generation function and to finally train the ranker.

Further steps are to be found in the files '6december_baseline_with_debug_extra' and '6december_function_based'.
The first one has only one difference in the title 'checking for NAN age groups', right above this title the one different line is th isna sum, which showed the difference.

The last file is '6december_function_based' where the submission are added so we can have a Kaggle score.
One of the changes is to be found in the candidate generation function on line 45 and on. It is the filler for the missing customers. This filler is returned as secondary return value and later also saved in a variable when this function is called.
Further the changes can be found on line 45 and on under the title 'use the generation for training and testing'. Here the test examples are created and the scores predicted. The generating of predictions for missing customers and making a submission is done from line 93 and on. 

## Only age groups
Here once again a small part is changed. This is after several tests and changes. Not all of them were saved as some resulted in very bad scores and even errors. But removing the candidates from bestsellers without removing the bestseller rank merging and the features from the feature list gave better results.
The line that changed can be found in file 'only_agegroup' at line 147.
Further discussion about the effect can be found at the end of the file in a markdown.

## Origin features
The last part in the research process is to be found in the file 'age_groups-with_origin'.
Here the main goal was to include a feature per candidate generation method indicating the method that created the candidates.
The change can be seen in the candidate generation function on line 148, or right after the section name 'Combine the transactions and negative examples'.
There each method gets a 1 in its feature column. A little bit later the rest of these columns are filled with zeroes as they are not generated by these sources.
As you can see on line 167, the line is commented as I chose not to use the bestsellers and only the age group bestsellers.
Right after is the collecting of all origins in one candidate. This means that one candidate that has multiple sources also has multiple origin features indicating as such.
The rest is kept intact.

In the adding features function the ability is presented to comment out these origin features. as shown on line 7 in the function cell.